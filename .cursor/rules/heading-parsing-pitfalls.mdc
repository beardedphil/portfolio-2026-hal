---
description: Common heading parsing pitfalls and how to avoid them when creating tickets and documents
alwaysApply: true
---

# Heading parsing pitfalls (and how to avoid them)

When creating tickets, documents, or any markdown content that HAL needs to parse, you must use headings correctly. Incorrect heading formatting can cause parsing failures, making content unreadable or causing validation errors.

## Pitfall 1: Inconsistent heading levels

**Problem:** Skipping heading levels (e.g., going from `#` to `###` without `##`) or mixing heading levels inconsistently.

**Example (BAD):**
```markdown
# Ticket

### Goal (one sentence)
This is wrong because we skipped ##
```

**Fix:** Use consistent heading levels. For tickets, all main sections should be `##` (level 2).

**Example (GOOD):**
```markdown
## Ticket

## Goal (one sentence)
This is correct - consistent ## level
```

## Pitfall 2: Ambiguous "pseudo-headings" instead of real markdown headings

**Problem:** Using bold text or colons to create headings instead of proper markdown heading syntax.

**Example (BAD):**
```markdown
**Goal:** This is not a real heading
**Acceptance criteria:** This won't be parsed correctly
```

**Fix:** Use proper markdown heading syntax with `#` characters.

**Example (GOOD):**
```markdown
## Goal (one sentence)
This is a real heading that HAL can parse

## Acceptance criteria (UI-only)
This will be correctly identified as a section
```

## Pitfall 3: Required ticket headings don't match canonical text exactly

**Problem:** Ticket headings must match the exact canonical text (case-sensitive). Variations like "Goals" instead of "Goal (one sentence)" will fail validation.

**Example (BAD):**
```markdown
## Goal
## Human-verifiable deliverable
## Acceptance Criteria
```

**Fix:** Use the exact canonical heading text as specified in the ticket template.

**Example (GOOD):**
```markdown
## Goal (one sentence)
## Human-verifiable deliverable (UI-only)
## Acceptance criteria (UI-only)
```

**Required canonical headings for tickets:**
- `## Goal (one sentence)`
- `## Human-verifiable deliverable (UI-only)`
- `## Acceptance criteria (UI-only)`
- `## Constraints`
- `## Non-goals`

## Pitfall 4: Duplicating the same top-level heading multiple times

**Problem:** Having multiple `# Ticket` or other top-level headings in the same document, which confuses parsers.

**Example (BAD):**
```markdown
# Ticket
Content here...

# Ticket
More content here... (duplicate!)
```

**Fix:** Use each heading level only once at the top level, or use different heading levels for subsections.

**Example (GOOD):**
```markdown
## Ticket
Content here...

## Additional Information
More content here... (different heading)
```

## Pitfall 5: Using bullets instead of checkboxes for Acceptance Criteria

**Problem:** Acceptance criteria must use checkbox syntax `- [ ]` not bullet points `- `, so HAL can track completion status.

**Example (BAD):**
```markdown
## Acceptance criteria (UI-only)

- Feature works correctly
- UI looks good
- Tests pass
```

**Fix:** Use checkbox syntax `- [ ]` for all acceptance criteria items.

**Example (GOOD):**
```markdown
## Acceptance criteria (UI-only)

- [ ] Feature works correctly
- [ ] UI looks good
- [ ] Tests pass
```

## Copy/paste examples

### Good: Minimal ticket skeleton (passes Definition of Ready)

```markdown
## Ticket

- **ID**: HAL-0181
- **Title**: HAL-0181 — Add heading parsing pitfalls section
- **Owner**: Implementation agent
- **Type**: Feature
- **Priority**: P1

## Goal (one sentence)

Add an explicit "Heading parsing pitfalls (and how to avoid them)" section to the agent instruction docs so agents consistently produce headings that HAL can parse and render correctly.

## Human-verifiable deliverable (UI-only)

In the HAL app, the **agent instructions UI** includes a clearly labeled section titled **"Heading parsing pitfalls (and how to avoid them)"** that lists concrete dos/don'ts and copy‑pasteable examples.

## Acceptance criteria (UI-only)

- [ ] Agent instruction docs include a new section titled **"Heading parsing pitfalls (and how to avoid them)"**.
- [ ] The section includes at least **5 concrete pitfalls** with **recommended fixes**.
- [ ] The section includes at least **2 copy/paste examples**.

## Constraints

- Keep this task as small as possible while still producing a **human-verifiable** UI change.
- Verification must require **no external tools** (no terminal, no devtools, no console).

## Non-goals

- Changing existing heading parsing logic
- Adding new validation rules
```

### Bad: Common failure mode (with corrections)

**BAD Example:**
```markdown
# Ticket

**Goal:** Add heading parsing section

**Acceptance Criteria:**
- Feature works
- UI looks good

### Constraints
Keep it simple
```

**Problems:**
1. Using `#` instead of `##` for main sections
2. Using bold pseudo-headings instead of real markdown headings
3. Heading text doesn't match canonical format ("Goal" instead of "Goal (one sentence)")
4. Using `###` (level 3) when should use `##` (level 2)
5. Using bullets `-` instead of checkboxes `- [ ]` for acceptance criteria

**CORRECTED Version:**
```markdown
## Ticket

- **ID**: HAL-0181
- **Title**: HAL-0181 — Add heading parsing pitfalls section

## Goal (one sentence)

Add an explicit "Heading parsing pitfalls (and how to avoid them)" section to the agent instruction docs.

## Acceptance criteria (UI-only)

- [ ] Feature works
- [ ] UI looks good

## Constraints

Keep it simple
```

## Summary

- Always use `##` (level 2) for main ticket sections
- Use proper markdown heading syntax (`## Heading`) not bold text
- Match canonical heading text exactly (case-sensitive)
- Don't duplicate top-level headings
- Use checkboxes `- [ ]` not bullets `- ` for acceptance criteria
- Follow the ticket template structure exactly
