---
description: Guidance on avoiding common heading parsing pitfalls in tickets and documents
alwaysApply: true
---

# Heading parsing pitfalls (and how to avoid them)

When writing tickets, artifacts, or any markdown documents that HAL needs to parse, proper heading structure is critical. HAL's parsers rely on exact heading formats to extract sections correctly. This guide covers common pitfalls and how to avoid them.

## Pitfall 1: Inconsistent heading levels (skipping levels)

**Problem:** Skipping heading levels (e.g., using `#` then `###` without `##`) creates an inconsistent document structure that can confuse parsers.

**Bad example:**
```markdown
# Ticket

### Goal (one sentence)
This is the goal.

### Acceptance criteria (UI-only)
- [ ] Criterion 1
```

**Fix:** Use consistent heading levels. Start with `#` for the top-level title, then use `##` for major sections.

**Good example:**
```markdown
# Ticket

## Goal (one sentence)
This is the goal.

## Acceptance criteria (UI-only)
- [ ] Criterion 1
```

**Recommendation:** For tickets, always use `##` for required sections (Goal, Human-verifiable deliverable, Acceptance criteria, Constraints, Non-goals). Never skip from `#` directly to `###` or deeper.

## Pitfall 2: Ambiguous "pseudo-headings" (bold lines or colons instead of markdown headings)

**Problem:** Using bold text (`**Section Name**`) or text with colons (`Section Name:`) instead of proper markdown headings (`## Section Name`) makes it impossible for parsers to reliably extract sections.

**Bad example:**
```markdown
**Goal (one sentence)**
This is the goal.

**Acceptance criteria (UI-only):**
- [ ] Criterion 1
```

**Fix:** Always use proper markdown headings (`##`) for section titles.

**Good example:**
```markdown
## Goal (one sentence)
This is the goal.

## Acceptance criteria (UI-only)
- [ ] Criterion 1
```

**Recommendation:** If you want a section title, use a heading. Bold text and colons are for emphasis within content, not for structural section markers.

## Pitfall 3: Required ticket headings don't match canonical text exactly

**Problem:** HAL's parsers use exact case-sensitive matching for required ticket sections. Even small variations (capitalization, spacing, punctuation) will cause sections to be missed.

**Bad examples:**
```markdown
## goal (one sentence)          # lowercase 'g'
## Goal (One Sentence)          # capital 'S'
## Goal(one sentence)          # missing space
## Goal (one sentence):         # extra colon
## Acceptance Criteria (UI-only) # capital 'C'
## Acceptance criteria          # missing "(UI-only)"
```

**Fix:** Use the exact canonical text for required sections, exactly as documented.

**Good example:**
```markdown
## Goal (one sentence)
This is the goal.

## Human-verifiable deliverable (UI-only)
A human will see X in the UI.

## Acceptance criteria (UI-only)
- [ ] Criterion 1
- [ ] Criterion 2

## Constraints
Constraint text here.

## Non-goals
Non-goal text here.
```

**Canonical required section titles:**
- `## Goal (one sentence)`
- `## Human-verifiable deliverable (UI-only)`
- `## Acceptance criteria (UI-only)`
- `## Constraints`
- `## Non-goals`

**Recommendation:** Copy-paste the exact section titles from the ticket template. Do not modify capitalization, spacing, or punctuation.

## Pitfall 4: Duplicating the same top-level heading multiple times

**Problem:** Having multiple `# Ticket` headings (or any duplicate top-level heading) in the same document creates ambiguity about which section is the "real" one.

**Bad example:**
```markdown
# Ticket

- **ID**: 0010
- **Title**: Example ticket

## Goal (one sentence)
Goal text.

# Ticket

- **ID**: 0011
- **Title**: Another ticket
```

**Fix:** Each document should have exactly one top-level heading (`#`). If you need to reference multiple tickets, use a different structure.

**Good example:**
```markdown
# Ticket

- **ID**: 0010
- **Title**: Example ticket

## Goal (one sentence)
Goal text.
```

**Recommendation:** If you're working with multiple tickets, create separate files or use a different document structure. Never duplicate the same `#` heading within one document.

## Pitfall 5: Using bullets instead of checkboxes for Acceptance Criteria

**Problem:** The Acceptance criteria section must use checkbox syntax (`- [ ]`) for HAL to recognize and parse criteria correctly. Regular bullets (`- `) or other list formats won't work.

**Bad example:**
```markdown
## Acceptance criteria (UI-only)

- Criterion 1
- Criterion 2
* Criterion 3
```

**Fix:** Always use checkbox syntax (`- [ ]`) for acceptance criteria items.

**Good example:**
```markdown
## Acceptance criteria (UI-only)

- [ ] Criterion 1
- [ ] Criterion 2
- [ ] Criterion 3
```

**Recommendation:** When writing acceptance criteria, always use `- [ ]` (dash, space, square brackets with space inside, space, then text). This format is required for HAL's parsers to extract criteria correctly.

## Copy-paste examples

### Good: Minimal ticket skeleton (passes Definition of Ready)

```markdown
# Ticket

- **ID**: 0010
- **Title**: Example feature
- **Owner**: Implementation agent
- **Type**: Feature
- **Priority**: P1

## Goal (one sentence)
Add a button that shows a confirmation dialog when clicked.

## Human-verifiable deliverable (UI-only)
A human will see a new "Confirm" button in the settings page. When clicked, a dialog appears asking "Are you sure?" with "Yes" and "No" buttons.

## Acceptance criteria (UI-only)

- [ ] A "Confirm" button appears in the settings page
- [ ] Clicking the button shows a dialog with "Are you sure?" text
- [ ] The dialog has "Yes" and "No" buttons
- [ ] Clicking "No" closes the dialog without changes
- [ ] Clicking "Yes" closes the dialog and shows a success message

## Constraints

- Keep the dialog styling consistent with existing dialogs
- Use the existing dialog component library

## Non-goals

- Persisting confirmation state across page reloads
- Customizing dialog text per button instance
```

### Bad: Common failure modes and corrections

**Bad example (multiple issues):**
```markdown
# Ticket

**Goal (one sentence):**
Add a button.

### Acceptance Criteria
- Criterion 1
- Criterion 2

# Ticket

- **ID**: 0011
```

**Issues:**
1. Using bold text instead of `##` heading for Goal
2. Skipping from `#` to `###` (inconsistent heading levels)
3. Wrong capitalization: "Acceptance Criteria" instead of "Acceptance criteria"
4. Missing "(UI-only)" suffix
5. Using bullets (`-`) instead of checkboxes (`- [ ]`)
6. Duplicate `# Ticket` heading

**Corrected version:**
```markdown
# Ticket

- **ID**: 0011
- **Title**: Example feature
- **Owner**: Implementation agent
- **Type**: Feature
- **Priority**: P1

## Goal (one sentence)
Add a button.

## Human-verifiable deliverable (UI-only)
A human will see a new button in the UI.

## Acceptance criteria (UI-only)

- [ ] Criterion 1
- [ ] Criterion 2

## Constraints

- Keep changes minimal

## Non-goals

- No additional features
```

## Summary checklist

Before submitting a ticket or document, verify:

- [ ] All section headings use proper markdown syntax (`##`, not bold text or colons)
- [ ] Heading levels are consistent (no skipping from `#` to `###`)
- [ ] Required ticket sections use exact canonical titles (case-sensitive, exact spacing and punctuation)
- [ ] Only one top-level heading (`#`) exists in the document
- [ ] Acceptance criteria use checkbox syntax (`- [ ]`) not bullets (`-`)
- [ ] All required sections are present with correct headings
