---
description: Require agents to review and justify conditional rendering decisions in UI components to prevent accidental feature removal and UX regressions
alwaysApply: true
---

# Conditional Rendering Review

**MANDATORY:** Before implementing or changing any conditional rendering in UI components, agents **must** complete the conditional rendering review checklist and document their decisions in their Plan or Decisions artifact.

## What is "Conditional Rendering"?

**Conditional rendering** is any code that shows, hides, or changes UI elements based on application state, user permissions, feature flags, or other runtime conditions. This includes:

### Examples of Conditional Rendering

- **Visibility toggles** (`{isVisible && <Component />}`, `{condition ? <A /> : <B />}`)
- **Permission-based rendering** (`{user.canEdit && <EditButton />}`)
- **Feature flag gating** (`{featureFlags.newFeature && <NewFeature />}`)
- **State-based display** (`{isLoading ? <Spinner /> : <Content />}`)
- **Role-based UI** (`{user.role === 'admin' && <AdminPanel />}`)
- **Conditional styling/classes** that significantly change visible behavior
- **Early returns** that prevent component rendering (`if (!condition) return null`)

## When This Requirement Applies

This requirement applies to **all agents** when implementing or modifying conditional rendering:

- **Implementation agents** — Must complete the checklist before implementing conditional rendering and document decisions in Plan or Decisions artifact
- **QA agents** — Must verify that conditional rendering decisions are properly documented and test the visible behavior
- **Project Manager agents** — Must ensure conditional rendering decisions align with product intent

**CRITICAL:** The conditional rendering review must be completed **before** implementing conditional rendering changes. Do not add or modify conditional rendering without completing this checklist.

## Conditional Rendering Review Checklist

**MANDATORY:** Before implementing or changing any conditional rendering, agents **must** complete this checklist and document the results in their Plan or Decisions artifact.

### Copy/Paste Checklist Template

```markdown
## Conditional Rendering Review

**Conditional rendering changes made:** [Yes / No]

If Yes, complete the following for each conditional rendering decision:

### Condition Details
- [ ] **What condition controls the rendering?** [Describe the condition, e.g., "user.isPremium", "featureFlags.newDashboard", "isLoading"]
- [ ] **Why does this condition exist?** [Explain the business/product reason, e.g., "Premium feature gating per ticket goal", "Prevent UI flicker during data fetch"]
- [ ] **What user segment/state does this affect?** [Specify affected users, e.g., "Non-premium users", "Users with incomplete profiles", "All users during initial load"]

### Expected Visible Behavior
- [ ] **What is the expected visible behavior when condition is TRUE?** [Describe what users see, e.g., "User sees 'Upgrade to Premium' button in header"]
- [ ] **What is the expected visible behavior when condition is FALSE?** [Describe what users see, e.g., "User sees standard header without upgrade button, or sees fallback message 'Feature available for premium users'"]

### Silent Removal Guardrail
- [ ] **Does this condition hide a feature that previously existed?** [Yes / No]
- [ ] **If Yes, should the feature be removed permanently or temporarily hidden?** [Removed / Hidden / N/A]
- [ ] **Justification for removal/hiding:** [Explain why this aligns with ticket goal and product intent, or note if this is a regression]

### UI-Only Verification Step
- [ ] **Verification steps:** [Provide at least one UI-only verification step that a human can perform without tools, e.g., "In the running app, visit the Settings page as a non-premium user and confirm the 'Upgrade' button is visible; visit as a premium user and confirm the button is hidden"]

### Code Locations
[Cite specific file paths and line numbers where conditional rendering was implemented, per `.cursor/rules/code-location-citations.mdc`]
```

## Example: Acceptable Conditional Rendering Documentation

### Example 1: Feature Visibility Based on User Role

```markdown
## Conditional Rendering Review

**Conditional rendering changes made:** Yes

### Condition Details
- **What condition controls the rendering?** `user.role === 'admin'`
- **Why does this condition exist?** The "Admin Settings" section should only be visible to users with admin role. This is required by the ticket goal to restrict sensitive configuration options to authorized users only.
- **What user segment/state does this affect?** Admin users see the "Admin Settings" section; non-admin users do not see it (feature is hidden, not removed).

### Expected Visible Behavior
- **When condition is TRUE (admin user):** The "Admin Settings" section is visible in the Settings page, containing controls for system configuration.
- **When condition is FALSE (non-admin user):** The "Admin Settings" section is not rendered at all (no empty space or placeholder). No fallback content is shown when the section is hidden.

### Silent Removal Guardrail
- **Does this condition hide a feature that previously existed?** No — this is a new feature being conditionally shown.
- **If Yes, should the feature be removed permanently or temporarily hidden?** N/A
- **Justification:** The Admin Settings feature remains in the codebase and is accessible to admin users. It is conditionally rendered based on user role, not removed. This aligns with product intent to show role-appropriate UI.

### UI-Only Verification Step
- **Verification steps:** 
  1. In the running app, navigate to the Settings page. When logged in as an admin user, confirm the "Admin Settings" section is visible at the bottom of the page with configuration controls.
  2. Log out and log in as a regular user, navigate to the Settings page, and confirm the "Admin Settings" section is not visible and the page ends after the "User Preferences" section.

### Code Locations
- `src/pages/Settings.tsx:45-52` — Conditional rendering of AdminSettings component based on `user.role === 'admin'`
```

### Example 2: Empty State Handling

```markdown
## Conditional Rendering Review

**Conditional rendering changes made:** Yes

### Condition Details
- **What condition controls the rendering?** `tickets.length === 0`
- **Why does this condition exist?** The ticket list should display an empty state message when no tickets exist, rather than showing a blank area. This improves UX by providing clear feedback to users.
- **What user segment/state does this affect?** All users: when the tickets list is empty (no tickets exist), see the empty state message; when tickets exist, see the ticket list.

### Expected Visible Behavior
- **When condition is TRUE (no tickets):** Display the empty state component with message "No tickets found. Create your first ticket to get started." and a "Create Ticket" button.
- **When condition is FALSE (tickets exist):** Display the ticket list with all tickets rendered. No transition animation between states (instant switch).

### Silent Removal Guardrail
- **Does this condition hide a feature that previously existed?** No — this is adding a feature, not removing one.
- **If Yes, should the feature be removed permanently or temporarily hidden?** N/A
- **Justification:** The empty state is a new feature being added. The ticket list feature itself is not being removed or hidden.

### UI-Only Verification Step
- **Verification steps:** 
  1. In the running app, navigate to the Tickets page. When no tickets exist, confirm the empty state message "No tickets found. Create your first ticket to get started." is displayed with a "Create Ticket" button.
  2. Create a ticket, then confirm the ticket list appears and the empty state is no longer visible.

### Code Locations
- `src/components/TicketList.tsx:23-35` — Conditional rendering: `{tickets.length === 0 ? <EmptyState /> : <TicketGrid tickets={tickets} />}`
```

### Example 3: Feature Flag Conditional Rendering

```markdown
## Conditional Rendering Review

**Conditional rendering changes made:** Yes

### Condition Details
- **What condition controls the rendering?** `user.betaFeaturesEnabled === true`
- **Why does this condition exist?** The "Beta Features" section should only be visible when the beta features flag is enabled. This allows gradual rollout of new features without exposing them to all users.
- **What user segment/state does this affect?** Users with beta features enabled see the "Beta Features" section; users with beta features disabled do not see it.

### Expected Visible Behavior
- **When condition is TRUE (beta enabled):** The "Beta Features" section is visible in the Settings page.
- **When condition is FALSE (beta disabled):** The "Beta Features" section is not rendered. No visual indication that a section is hidden (seamless UI).

### Silent Removal Guardrail
- **Does this condition hide a feature that previously existed?** No — this is a new feature being conditionally shown.
- **If Yes, should the feature be removed permanently or temporarily hidden?** N/A
- **Justification:** Beta features are temporarily hidden from users who don't have the flag enabled. The feature code remains in the codebase and can be enabled per-user. This aligns with product intent for gradual feature rollout.

### UI-Only Verification Step
- **Verification steps:** 
  1. In the running app, navigate to the Settings page. When the user has beta features enabled (check user profile or feature flag), confirm the "Beta Features" section appears between "User Preferences" and "Account Settings".
  2. When beta features are disabled, confirm the "Beta Features" section is not visible and the page flows directly from "User Preferences" to "Account Settings".

### Code Locations
- `src/pages/Settings.tsx:78-85` — Conditional rendering: `{user.betaFeaturesEnabled && <BetaFeaturesSection />}`
```

## Integration with Existing Workflows

### Plan or Decisions Artifact

The conditional rendering review checklist must be included in the **Plan artifact** (for planned conditional rendering) or **Decisions artifact** (for conditional rendering decisions made during implementation), stored in Supabase:
- **Artifact type:** `plan` or `decisions`
- **Title format:** `Plan for ticket <ticket-id>` or `Decisions for ticket <ticket-id>`
- **Storage:** Via HAL API endpoint `/api/artifacts/insert-implementation` with appropriate `artifactType`

### QA Review Requirements

**MANDATORY:** When QA agents review a ticket that includes conditional rendering changes, they **must**:

1. **Verify the Plan or Decisions artifact includes the conditional rendering review checklist** — If conditional rendering changes were made but the checklist is missing or incomplete, QA **MUST FAIL** the ticket.

2. **Verify the documented behavior matches the ticket goal** — QA should confirm:
   - The "Why does this condition exist?" aligns with the ticket's Goal
   - The expected visible behavior matches the ticket's Human-verifiable deliverable
   - Any feature hiding/removal is intentional and justified

3. **Perform UI verification** — QA must execute the documented UI-only verification steps and confirm the behavior matches the documented expectations.

4. **Check for silent removals** — QA must verify that any hidden features are intentional (not accidental regressions) and properly documented.

5. **Include conditional rendering review in QA report** — QA reports should include a section confirming:
   - Conditional rendering changes were properly documented (or "No conditional rendering changes" if none were made)
   - The documented behavior matches code review findings
   - UI verification confirms the documented behavior
   - Any concerns about accidental feature removal or UX regressions

### QA Report Template Addition

QA reports should include:

```markdown
## Conditional Rendering Review

**Conditional rendering changes:** [Yes / No]

If Yes:
- [ ] Plan/Decisions artifact includes complete conditional rendering review checklist
- [ ] Documented condition aligns with ticket goal: [Yes / No]
- [ ] Documented visible behavior matches ticket deliverable: [Yes / No]
- [ ] UI verification steps executed: [Yes / No]
- [ ] UI behavior matches documented expectations: [Yes / No]
- [ ] No silent feature removals detected (or removals are intentional and documented): [Yes / No]
- [ ] Concerns identified: [None / List any concerns]
```

### QA Audit Report

QA agents must verify conditional rendering documentation as part of their standard QA workflow (see `.cursor/rules/qa-audit-report.mdc`).

## Scope

- Applies to **all agents** (implementation, QA, PM) when conditional rendering is involved
- Applies to **all conditional rendering** in UI components (React, Vue, or other framework conditionals like `{condition && <Component />}`, `v-if`, `*ngIf`, etc.)
- Applies when **adding**, **modifying**, or **removing** conditional rendering logic
- Must be completed **before** claiming implementation is complete
- The checklist must be **human-verifiable** — a reviewer can open the Plan or Decisions artifact and immediately see the conditional rendering decisions and their justification
- When in doubt, **document the decision** — it's better to over-document than to accidentally hide or remove features without justification
- This requirement helps prevent:
  - Accidental feature removal (hiding features that should remain visible)
  - UX regressions (changing visible behavior without product justification)
  - Silent breaking changes (removing functionality without explicit decision)
