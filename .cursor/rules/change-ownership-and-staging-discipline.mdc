---
description: Prevent committing unrelated changes; staging and ownership discipline
alwaysApply: true
---

# Change Ownership + Staging Discipline

## GATE: No edits on main (see also no-edits-on-main.mdc)

- **Before using StrReplace, Write, or EditNotebook** for a ticket: run `git status -sb`. If the current branch is **`main`**, you **must not** make any file edits. Create or checkout the feature branch first, then edit.
- **FORBIDDEN:** Implementing ticket work on `main` or any branch other than the ticket's feature branch. This is non-negotiable.

## FIRST: Create feature branch before any edits (mandatory)

- **BEFORE making your first edit** for a ticket, you MUST be on the correct feature branch.
- **Required first action** when implementing a ticket (before touching any file):
  1. Run `git status -sb`. Note the current branch.
  2. Derive the feature branch name: `ticket/<id>-<short-title-kebab>` (e.g. ticket 0030 → `ticket/0030-ticket-list-add-delete-button-and-sync-deletion-to-filesystem`).
  3. If the current branch is **not** that feature branch (including if it is `main`):
     - Run `git checkout -b ticket/<id>-<short-title-kebab>` (or `git checkout ticket/<id>-...` if it already exists).
     - Do this **before** any file edits.
- **Why:** Edits on `main` conflate your work with others'; they can be lost if the tree is reset; they violate the branching policy. Branch first, then edit.

## Only commit what your ticket changes

- An agent must only commit changes that belong to the **current ticket** they are implementing.
- **FORBIDDEN:** bundling unrelated file changes into the ticket commit (including stray edits, formatting passes, or leftover untracked files).

## Concurrency safety (assume other agents may be running)

- Always assume **another agent might be editing files in parallel** in the same repo.
- **FORBIDDEN:** touching, restoring, staging, committing, or deleting files you did not personally change in the current task.
  - Do **not** “clean up” other agents’ work-in-progress.
  - Do **not** run broad commands that can affect unrelated files (examples: `git add .`, `git add -A`, `git restore .`, `git checkout .`, mass-formatting).
  - Do **not** run `git stash` (or `git stash -u`) on the whole working tree unless you are certain no other agent has uncommitted work there — stashing removes uncommitted changes from the working tree; if another agent was implementing a ticket on a feature branch but had not yet committed, their code would exist only in the stash and can be lost.
- If you need a clean place to work while the main working tree is dirty, use a **git worktree** so your changes are isolated.

## Staging discipline (required)

Before committing ticket work:

- Review `git diff` and `git status` and ensure every changed file is expected.
- Stage only the intended files (explicit `git add <paths>`).
- If any unrelated changes exist:
  - revert them, delete them, or move them into a **separate ticket/branch**.

## Do not “fix someone else’s work” inside a ticket

- If you discover a problem outside the ticket scope (including process cleanup), do **not** fold it into the ticket.
- Create a new ticket via the **HAL app** (PM agent) or a **script that writes to Supabase** (preferred), then fix it on its own branch. Do not write a ticket file in `docs/tickets/`; tickets are created only in Supabase and propagate to docs via sync. For column/status moves, update the DB (e.g. `node scripts/move-ticket-column.js <id> <columnId>`), then run sync — do not edit ticket frontmatter by hand.

## Branching requirement (ties to done-means-pushed)

- Ticket work must be performed on `ticket/<id>-<short-title-kebab>` branches.
- Do not commit ticket work directly on `main`.
- If you discover you implemented on `main`: create the feature branch, then `git checkout -b ticket/<id>-...` — uncommitted changes will move with you. Commit on the feature branch.
