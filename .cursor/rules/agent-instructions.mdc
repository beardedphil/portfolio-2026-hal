---
description: Entry point for agent instructions - load basic rules from Supabase
alwaysApply: true
---

# Agent Instructions Entry Point

**All agent instructions are stored in Supabase and accessed via HAL API endpoints.**

## First Step: Load Basic Instructions

**MANDATORY:** Before starting any work, you **must** load your basic instructions from Supabase.

### How to Load Instructions

1. **Read the HAL API base URL:**
   ```javascript
   const baseUrl = (await readFile('.hal/api-base-url', 'utf8')).trim()
   ```

2. **Load basic instructions for your agent type:**
   ```javascript
   const res = await fetch(`${baseUrl}/api/instructions/get`, {
     method: 'POST',
     headers: { 'Content-Type': 'application/json' },
     body: JSON.stringify({
       agentType: 'implementation', // or 'qa', 'project-manager', etc.
       includeBasic: true,
       includeSituational: false,
     }),
   })
   const result = await res.json()
   if (result.success) {
     // result.instructions contains your basic instructions
     // These include rules for all agents + rules specific to your agent type
   }
   ```

3. **Read and follow the instructions** - They contain all mandatory workflows, artifact requirements, and procedures.

## Discovering Available Instruction Sets

To see what additional instruction sets are available:

```javascript
const res = await fetch(`${baseUrl}/api/instructions/get-index`, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({}),
})
const result = await res.json()
if (result.success) {
  // result.index contains:
  // - basic: list of basic instruction topic IDs
  // - situational: map of agent types to available situational instruction sets
  // - topics: metadata about each topic
}
```

## Requesting Additional Instructions

If you need additional instructions during your work, request a specific topic:

```javascript
const res = await fetch(`${baseUrl}/api/instructions/get-topic`, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    topicId: 'auditability-and-traceability', // or any topic ID from the index
  }),
})
const result = await res.json()
if (result.success) {
  // result.content contains the full instruction content
}
```

## Instruction Structure

- **Basic Instructions** - Automatically loaded for your agent type (includes rules for all agents + your specific agent type)
- **Situational Instructions** - Available on-demand via topic ID (use when you need specific guidance)

## Editing Instructions

Instructions are edited in the HAL app UI (not in `.cursor/rules`):
- Click "Agent Instructions" button in the HAL app header
- Browse the instruction hierarchy (All Agents → Agent Type → Instruction)
- Click "Edit" to modify instructions (saves directly to Supabase)

**Note:** This file (`.cursor/rules/agent-instructions.mdc`) is only an entry point. All actual instructions live in Supabase.
