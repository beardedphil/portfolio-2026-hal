---
description: QA agents must add a qa-report to the ticket audit folder
alwaysApply: true
---

# QA Audit Report (QA Agents)

When you **QA a ticket** (e.g. user asks to "QA", "verify", or "check" a ticket that is allegedly complete), you **must** add a QA report to that ticket’s audit folder.

## Cloud QA workflow context

In cloud environments, QA agents may not have access to feature branches (only `main`). When this is the case, the implementation agent merges the feature branch to `main` before QA begins. QA must then verify from `main` rather than attempting to check out a feature branch. This workflow is indicated when the ticket states "merged to `main` for QA access" or similar language.

## Which branch to use (decision rule)

- **If the ticket or prompt states that the implementation was "merged to main for QA access"** (or that code is on `main` for QA): 
  - You **must** verify from the **`main`** branch. 
  - Do **not** attempt to locate, check out, or use the feature branch.
  - **Step 1:** Pull the latest `main` branch: `git checkout main && git pull origin main`
  - **Step 2:** Perform QA on `main` (code review and verification).
  - **Step 3:** Record in `qa-report.md` that verification was performed against `main` (e.g. "Verified on `main`; implementation was merged to main for QA access.").
  - **Step 4:** After verification, commit the qa-report to `main` (do not merge again — the change is already on `main`).
  - **Step 5:** Move ticket to Human in the Loop (DB-first), then provide summary.
- **Otherwise:** use the feature branch named in the ticket's QA → Branch field (or the branch you were launched on). Perform QA on that branch, then follow the full workflow (merge to main, delete branch, etc.).

**Important:** When QA cannot access feature branches (cloud QA workflow), the implementation agent merges the feature branch to `main` before QA. In this case, QA must verify from `main` and record this in both the `qa-report.md` and note it in the ticket artifacts/links.

## Required artifact

- **Path:** `docs/audit/<task-id>-<short-title>/qa-report.md`
- **When:** After performing QA (code review and, if possible, UI verification) for a ticket.

## qa-report.md structure

1. **Ticket & deliverable** — One-line goal, deliverable, and acceptance criteria from the ticket.
2. **Audit artifacts** — Confirm all required audit files are present (plan, worklog, changed-files, decisions, verification, pm-review).
3. **Code review** — PASS/FAIL with brief evidence (e.g. table of requirement vs implementation; file and line refs if helpful).
4. **UI verification** — What was run: automated and/or manual steps from `verification.md`. If automated UI was not run (e.g. native dialogs, login, or pickers), state that and list the manual steps the user should run.
5. **Verdict** — Implementation complete? OK to merge? Any blocking manual verification?

## Example location

For ticket `docs/tickets/0026-kanban-tickets-persist-column-on-refresh.md`, the QA report is:

`docs/audit/0026-kanban-tickets-persist-column-on-refresh/qa-report.md`

## QA completion: do not hand off to the user

When the verdict is **PASS (OK to merge)**, QA must **complete the full workflow** — do not stop at a summary or "next steps for the user."

**If you are verifying from the feature branch** (normal workflow):

1. **Commit and push** the qa-report (and any rule changes) to the feature branch.
2. **Move ticket to Human in the Loop** — update the ticket **in the DB**, then run sync. Use `node scripts/move-ticket-column.js <ticketId> col-human-in-the-loop` from the repo root (e.g. `node scripts/move-ticket-column.js 0047 col-human-in-the-loop`). Requires `.env` with `SUPABASE_URL` and `SUPABASE_ANON_KEY`. The script updates Supabase, then the ticket file frontmatter, then runs `sync-tickets`. **Do not** add or edit YAML frontmatter in the ticket file by hand — Kanban is Supabase-backed; always update DB first, then sync.
3. **Merge to main** — checkout `main`, merge the feature branch, push `main`.
4. **Delete the feature branch** — local and remote (see `delete-branch-after-merge.mdc`).
5. **Then** give your summary to the user.

**If you are verifying from `main`** (implementation was merged to main for QA access):

1. **Commit and push** the qa-report (and any rule changes) to **`main`**. 
   - Do **not** merge again — the change is already on `main`. 
   - Do **not** delete any branch (the feature branch may still exist, but QA does not manage it in this workflow).
2. **Record verification context in the ticket** — Update the ticket body (in Supabase, then run `npm run sync-tickets`) to include:
   - Link to `docs/audit/<ticket-id>-<short-title>/qa-report.md`
   - Note that verification was performed against `main` (not the feature branch)
   - Any other relevant audit artifact links
3. **Move ticket to Human in the Loop** — Update the ticket **in the DB first**, then run sync. Use `node scripts/move-ticket-column.js <ticketId> col-human-in-the-loop` from the repo root (e.g. `node scripts/move-ticket-column.js 0047 col-human-in-the-loop`). Requires `.env` with `SUPABASE_URL` and `SUPABASE_ANON_KEY`. The script updates Supabase, then the ticket file frontmatter, then runs `sync-tickets`. **Do not** add or edit YAML frontmatter in the ticket file by hand — Kanban is Supabase-backed; always update DB first, then sync.
4. **Then** give your summary to the user.

Do not give a summary with "next steps" or "run these commands" — QA performs the merge (or confirms main) and branch deletion where applicable. The user receives the completed result.

- Use a commit subject that includes the ticket ID (e.g. `qa(0033): add QA report, move to Human in the Loop`).
- **If verdict is FAIL:** Do not merge. Commit and push the qa-report only; summarize findings and recommend a bugfix ticket (see `bugfix-tracking.mdc`).

## Scope

- Applies to any QA or verification of a **ticketed** task (ticket under `docs/tickets/` with a matching folder under `docs/audit/`).
- Keep the report concise; use bullets and tables where appropriate.
