---
description: QA agents must store QA reports in Supabase via HAL API
alwaysApply: true
---

# QA Audit Report (QA Agents)

When you **QA a ticket** (verify, check a ticket that is allegedly complete), store a QA report via HAL API. See `docs/process/hal-tool-call-contract.mdc` for endpoints.

## Branch to use

- **If ticket states "merged to main for QA access":** Verify from `main`. Do not use feature branch. Record in report that verification was on `main`.
- **Otherwise:** Use feature branch from ticket; full workflow (merge to main, delete branch).

## 8 required implementation artifacts (must be present before QA)

1. plan, 2. worklog, 3. changed-files, 4. decisions, 5. verification, 6. pm-review, 7. git-diff, 8. instructions-used

**Changed Files:** Must be NON-EMPTY. When files changed: list paths with brief descriptions. When no files changed: state "No files changed." with reason. Blank/empty = PROCESS FAILURE.

**How to check:** `POST ${baseUrl}/api/artifacts/get` with `{ ticketId }`. Filter `agent_type === "implementation"`. Match titles `Plan for ticket X`, etc.

**Auto-fail:** API fails, any artifact missing, or Changed Files blank → QA FAIL immediately. Store QA report, move to `col-todo`, final message: `QA RESULT: FAIL — <ticket-id>`.

## QA report structure

1. Ticket & deliverable
2. Missing artifacts (if any) — list them, then fail
3. Audit artifacts present (if all present)
4. Code review — PASS/FAIL with evidence
5. Build verification — **MANDATORY:** `npm run build:hal`; TypeScript errors = FAIL
6. UI verification — automated and/or manual steps
7. AC Confirmation Checklist — enumerate each AC, Met/Not met with evidence; see `ac-confirmation-checklist.mdc`
8. Verdict — PASS or FAIL

## Storing QA report

Make actual HTTP calls: `POST ${baseUrl}/api/artifacts/insert-qa` with `{ ticketId, title, body_md }`. Use `curl` or run_terminal_cmd. Do not just include JSON in your message.

## Implementation Agent Note (for FAIL verdicts)

**MANDATORY:** When a ticket fails QA (or HITL), you **MUST** create a separate, concise "Implementation agent note" artifact that explains why the ticket failed. This note is for implementation agents to quickly understand what needs to be fixed.

**Format:**
- Title: `Implementation agent note for ticket HAL-XXXX` (preferred) or `Note for implementation agent: HAL-XXXX`
- Keep it short (2-4 bullet points max)
- Focus on actionable items
- No detailed analysis—just what's wrong and what to fix
- Implementation agents are required to check for this artifact first before starting work

**Example structure:**
```markdown
# Implementation Agent Note: HAL-XXXX

## Status: FAIL

## Why This Ticket Failed

1. **Issue 1:** Brief description
2. **Issue 2:** Brief description

## Required Actions

1. Action item 1
2. Action item 2
3. Action item 3

## Code Review Notes

Brief note if implementation is otherwise correct.
```

**Store via:** `POST ${baseUrl}/api/artifacts/insert-qa` with `{ ticketId, title: "Implementation agent note for ticket HAL-XXXX", body_md }`

## Completion

- **PASS:** Store report, move to `col-human-in-the-loop`, merge to main, delete branch, then summary. Final message must include: `QA RESULT: PASS — <ticket-id>`
- **FAIL:** Store full QA report, **store Implementation agent note**, move to `col-todo`, then summary. Final message must include: `QA RESULT: FAIL — <ticket-id>`
