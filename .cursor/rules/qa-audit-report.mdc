---
description: QA agents must store QA reports in Supabase via HAL API
alwaysApply: true
---

# QA Audit Report (QA Agents)

When you **QA a ticket** (verify, check a ticket that is allegedly complete), store a QA report via HAL API. See `docs/process/hal-tool-call-contract.mdc` for endpoints.

## Branch to use

- **If ticket states "merged to main for QA access":** Verify from `main`. Do not use feature branch. Record in report that verification was on `main`.
- **Otherwise:** Use feature branch from ticket; full workflow (merge to main, delete branch).

## 8 required implementation artifacts (must be present before QA)

1. plan, 2. worklog, 3. changed-files, 4. decisions, 5. verification, 6. pm-review, 7. git-diff, 8. instructions-used

**Changed Files:** Must be NON-EMPTY. When files changed: list paths with brief descriptions. When no files changed: state "No files changed." with reason. Blank/empty = PROCESS FAILURE.

**How to check:** `POST ${baseUrl}/api/artifacts/get` with `{ ticketId }`. Filter `agent_type === "implementation"`. Match titles `Plan for ticket X`, etc.

**Auto-fail:** API fails, any artifact missing, or Changed Files blank → QA FAIL immediately. Store QA report, move to `col-todo`, final message: `QA RESULT: FAIL — <ticket-id>`.

## QA report structure

1. Ticket & deliverable
2. Missing artifacts (if any) — list them, then fail
3. Audit artifacts present (if all present)
4. Code review — PASS/FAIL with evidence
5. Build verification — **MANDATORY:** `npm run build:hal`; TypeScript errors = FAIL
6. UI verification — automated and/or manual steps
7. AC Confirmation Checklist — enumerate each AC, Met/Not met with evidence; see `ac-confirmation-checklist.mdc`
8. Verdict — PASS or FAIL

## Storing QA report

Make actual HTTP calls: `POST ${baseUrl}/api/artifacts/insert-qa` with `{ ticketId, title, body_md }`. Use `curl` or run_terminal_cmd. Do not just include JSON in your message.

## Completion

- **PASS:** Store report, move to `col-human-in-the-loop`, merge to main, delete branch, then summary. Final message must include: `QA RESULT: PASS — <ticket-id>`
- **FAIL:** Store report, move to `col-todo`, then summary. Final message must include: `QA RESULT: FAIL — <ticket-id>`
