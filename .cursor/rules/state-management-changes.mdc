---
description: Requirement to document state management changes in PM reviews and QA reports
alwaysApply: true
---

# State Management Changes Documentation Requirement

**MANDATORY:** Any change to application state management **must** be explicitly called out and justified in the agent's review artifacts (PM review and QA report). This requirement helps reviewers quickly understand behavioral risk and potential migration considerations.

## What is a "State Management Change"?

A **state management change** is any modification to how application state is stored, accessed, synchronized, or persisted. This includes but is not limited to:

### Examples of State Management Changes

- **Store/Reducer modifications:**
  - Adding, removing, or modifying Zustand store slices
  - Redux store/reducer changes
  - Jotai/Recoil atom changes
  - Any global state store mutations

- **Context Provider changes:**
  - React Context provider modifications
  - Context value structure changes
  - New context providers added
  - Context provider removal or consolidation

- **Persistence/Hydration changes:**
  - localStorage/sessionStorage schema changes
  - IndexedDB schema or access pattern changes
  - File-based persistence changes
  - Server-side state persistence changes
  - State migration logic (e.g., version upgrades)

- **Cache/Query changes:**
  - React Query/TanStack Query cache invalidation strategy changes
  - SWR cache key or revalidation changes
  - Apollo Client cache policies
  - Any query cache structure modifications

- **Cross-tab/Cross-window synchronization:**
  - BroadcastChannel API usage
  - SharedWorker state synchronization
  - localStorage event listeners for cross-tab sync
  - Service Worker state management

- **State shape/structure changes:**
  - Adding new top-level state properties
  - Removing or renaming state properties
  - Changing state property types
  - Nested state structure modifications

### What is NOT a State Management Change

- **UI-only changes:** Component prop changes, styling updates, layout modifications (unless they affect state structure)
- **Pure function changes:** Utility functions, helpers, formatters (unless they're state selectors/transformers)
- **API endpoint changes:** Backend API modifications (unless they affect how state is fetched/stored)
- **Type-only changes:** TypeScript type definitions that don't affect runtime state structure

## Documentation Requirement

### For Implementation Agents (PM Review)

**MANDATORY:** If your implementation includes any state management changes, you **must** include a "State Management Changes" section in your PM Review artifact using the template below.

**When to include:**
- Include this section if you modified any state management code (stores, context, persistence, cache, etc.)
- If you're unsure whether a change qualifies, err on the side of including it
- If there are no state management changes, you may omit this section

**Copy/paste this checklist into your PM Review:**

```markdown
## State Management Changes

**State management modified:** [Yes/No]

If Yes, complete the following:

### What Changed
- **Store/Context/Cache:** [Name of store/context/cache, e.g., "kanbanStore", "AppContext", "ticketsQueryCache"]
- **Files modified:** [List files, e.g., "src/stores/kanban.ts", "src/contexts/AppContext.tsx"]
- **Change type:** [e.g., "Added new slice", "Modified existing reducer", "Changed persistence schema", "Updated cache invalidation"]

### Why This Change Was Needed
[Brief explanation of the business/technical reason, e.g., "Required to persist column positions across page refreshes", "Needed to support real-time updates from multiple tabs"]

### Migration Considerations
- **Breaking changes:** [Yes/No] — [If yes, describe what breaks and how users are affected]
- **Data migration required:** [Yes/No] — [If yes, describe migration steps or version handling]
- **Backward compatibility:** [Yes/No] — [If yes, describe how old state is handled]

### User-Visible Impact
- **Behavioral changes:** [Describe what users will notice, e.g., "Column positions now persist after refresh", "State syncs across browser tabs"]
- **Performance impact:** [Any performance implications, e.g., "Additional localStorage writes on every column move", "Cache invalidation may cause brief loading states"]
- **Edge cases:** [Any edge cases or failure modes, e.g., "If localStorage is disabled, falls back to session-only state", "Cross-tab sync may have 100-200ms delay"]
```

### For QA Agents (QA Report)

**MANDATORY:** When reviewing a ticket that includes state management changes, QA **must** verify that:

1. The PM Review artifact includes a "State Management Changes" section (if state management was modified)
2. The section is complete (all checklist items filled out)
3. The documented changes match the actual code changes
4. Migration considerations are addressed (if applicable)

**QA Report checklist:**

```markdown
## State Management Changes Review

**State management modified in this ticket:** [Yes/No]

If Yes:
- [ ] PM Review includes "State Management Changes" section
- [ ] Section is complete (all checklist items filled)
- [ ] Documented changes match actual code changes
- [ ] Migration considerations addressed (if applicable)
- [ ] User-visible impact is clearly described
- [ ] Edge cases and failure modes are documented

**QA Notes:**
[Any additional observations about state management changes, potential risks, or verification steps]
```

## Rationale

State management changes are high-risk because they:
- Can affect application behavior across multiple components
- May require data migration or backward compatibility handling
- Can introduce subtle bugs that are difficult to detect
- May impact performance or user experience
- Could break existing functionality if not carefully considered

By requiring explicit documentation, reviewers can:
- Quickly identify behavioral risk areas
- Understand migration requirements before merging
- Verify that edge cases are considered
- Assess the impact on user experience
- Make informed decisions about code review priority

## Integration with Existing Workflows

- **PM Review:** Implementation agents must include the state management checklist when applicable
- **QA Report:** QA agents must verify the checklist is present and complete
- **Code Review:** Human reviewers can reference the documented state management changes for focused review

This requirement complements existing artifact requirements and does not replace other documentation needs (e.g., decisions, verification steps).
