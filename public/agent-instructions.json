{
  "index": {
    "basic": [],
    "situational": {},
    "topics": {}
  },
  "instructions": [
    {
      "path": "agent-instructions.mdc",
      "name": "agent instructions",
      "description": "HAL instruction-loading entry point for all agents",
      "alwaysApply": true,
      "content": "# Agent Instructions Entry Point\n\nThis local file is an entry point only. It is not the source of truth for instruction content.\n\n## Source of Truth\n\nAgent instructions live in Supabase and must be retrieved through HAL API endpoints.\n\n## Required Loading Flow\n\n1. **Load global bootstrap instructions (all agents):**\n   - `POST /api/instructions/get`\n   - Body: `{ repoFullName?: string, agentType: \"all\", includeBasic: true, includeSituational: false }`\n   - Purpose: global instructions shared by all agents, including how to request more instructions.\n\n2. **Load full instruction set for your agent type:**\n   - `get_instruction_set({ agentType: \"<agent-type>\" })`\n   - Agent types: `project-manager`, `implementation-agent`, `qa-agent`, `process-review-agent`\n   - Purpose: all core instructions for that agent, plus additional on-demand topics.\n\n3. **Load specific topics only when needed:**\n   - `get_instruction_set({ topicId: \"<topic-id>\" })`\n   - or `POST /api/instructions/get-topic`\n\n## HAL Endpoints\n\n- **Get instructions:** `POST /api/instructions/get`\n  - Body: `{ repoFullName?: string, agentType?: string, includeBasic?: boolean, includeSituational?: boolean }`\n- **Get specific topic:** `POST /api/instructions/get-topic`\n  - Body: `{ topicId: string, repoFullName?: string }`\n- **Get instruction index:** `POST /api/instructions/get-index`\n  - Body: `{ repoFullName?: string }`\n\nIf HAL/Supabase is unavailable, instruction sets are not considered loaded.\n",
      "agentTypes": [
        "all",
        "qa-agent",
        "implementation-agent",
        "project-manager",
        "process-review-agent"
      ],
      "topicId": "agent-instructions",
      "isBasic": false,
      "isSituational": false
    },
    {
      "path": "qa-audit-report.mdc",
      "name": "qa audit report",
      "description": "QA agents must store QA reports in Supabase via HAL API",
      "alwaysApply": true,
      "content": "# QA Audit Report (QA Agents)\n\nWhen you **QA a ticket** (e.g. user asks to \"QA\", \"verify\", or \"check\" a ticket that is allegedly complete), you **must** store a QA report in Supabase via HAL's API endpoints.\n\n## Cloud QA workflow context\n\nIn cloud environments, QA agents may not have access to feature branches (only `main`). When this is the case, the implementation agent merges the feature branch to `main` before QA begins. QA must then verify from `main` rather than attempting to check out a feature branch. This workflow is indicated when the ticket states \"merged to `main` for QA access\" or similar language.\n\n## Which branch to use (decision rule)\n\n- **If the ticket or prompt states that the implementation was \"merged to main for QA access\"** (or that code is on `main` for QA): \n  - You **must** verify from the **`main`** branch. \n  - Do **not** attempt to locate, check out, or use the feature branch.\n  - **Step 1:** Pull the latest `main` branch: `git checkout main && git pull origin main`\n  - **Step 2:** Perform QA on `main` (code review and verification).\n  - **Step 3:** Record in the QA report that verification was performed against `main` (e.g. \"Verified on `main`; implementation was merged to main for QA access.\").\n  - **Step 4:** Store the QA report in Supabase via HAL API (see \"Storing QA report\" below).\n  - **Step 5:** Move ticket to Human in the Loop via HAL API, then provide summary.\n- **Otherwise:** use the feature branch named in the ticket's QA → Branch field (or the branch you were launched on). Perform QA on that branch, then follow the full workflow (merge to main, delete branch, etc.).\n\n**Important:** When QA cannot access feature branches (cloud QA workflow), the implementation agent merges the feature branch to `main` before QA. In this case, QA must verify from `main` and record this in the QA report stored in Supabase.\n\n## Required implementation artifacts (must be present before QA)\n\n**MANDATORY:** Before performing any QA work, you **must** verify that all required implementation artifacts are present in Supabase. If any are missing, QA **must fail immediately** without attempting code review or verification.\n\n**Required implementation artifacts:**\n1. **Plan artifact** (`artifactType: \"plan\"`, title: `Plan for ticket <ticket-id>`)\n2. **Worklog artifact** (`artifactType: \"worklog\"`, title: `Worklog for ticket <ticket-id>`)\n3. **Changed Files artifact** (`artifactType: \"changed-files\"`, title: `Changed Files for ticket <ticket-id>`)\n4. **Decisions artifact** (`artifactType: \"decisions\"`, title: `Decisions for ticket <ticket-id>`)\n5. **Verification artifact** (`artifactType: \"verification\"`, title: `Verification for ticket <ticket-id>`)\n6. **PM Review artifact** (`artifactType: \"pm-review\"`, title: `PM Review for ticket <ticket-id>`)\n7. **Git diff artifact** (`artifactType: \"git-diff\"`, title: `Git diff for ticket <ticket-id>`)\n8. **Instructions Used artifact** (`artifactType: \"instructions-used\"`, title: `Instructions Used for ticket <ticket-id>`)\n\n**How to check for artifacts:**\n1. **First step (MANDATORY):** Call HAL API endpoint `/api/artifacts/get` with `{ ticketId: \"<ticket-id>\" }` to fetch all artifacts for the ticket.\n   - If `.hal/api-base-url` exists, read it and call: `POST ${baseUrl}/api/artifacts/get`\n   - If API call fails (404, 500, network error, etc.), **QA MUST FAIL** — you cannot verify artifacts exist, so assume they are missing.\n   - **DO NOT proceed with code review if artifact verification fails.**\n2. Filter the returned artifacts to find implementation artifacts (where `agent_type === \"implementation\"`).\n3. Check that all 8 required artifact types are present by matching artifact titles:\n   - `Plan for ticket <ticket-id>`\n   - `Worklog for ticket <ticket-id>`\n   - `Changed Files for ticket <ticket-id>`\n   - `Decisions for ticket <ticket-id>`\n   - `Verification for ticket <ticket-id>`\n - `PM Review for ticket <ticket-id>`\n - `Git diff for ticket <ticket-id>`\n - `Instructions Used for ticket <ticket-id>`\n\n**Auto-fail when artifacts are missing or unverifiable:**\n- **If artifact API call fails (404, 500, network error, timeout):** QA **must fail immediately**. You cannot verify artifacts exist, so treat as missing.\n- **If any required artifact is missing:** QA **must fail immediately**.\n- **Do NOT** attempt code review, verification, or any other QA work when artifacts cannot be verified or are missing.\n- **Do NOT** attempt to \"guess\" or recreate missing artifacts.\n- **Do NOT** proceed with code review and note \"artifacts couldn't be verified\" — this is a FAIL condition.\n- **Record a QA Fail outcome** by storing a QA report that clearly states the failure reason.\n- **The QA report must enumerate the specific missing artifacts** (or state \"Artifact verification failed: API returned [error]\" if API call failed).\n- **Store the QA report in Supabase** using `insert_qa_artifact` tool (via HAL API or queue file).\n- **Move ticket to To-do** (`col-todo`) via HAL API.\n- **The final message must include:** `QA RESULT: FAIL — <ticket-id>` (see \"Completion message format requirement\" below).\n\n**Example QA report when artifacts are missing:**\n```markdown\n# QA Report for ticket 0076\n\n## Ticket & Deliverable\n[Brief summary from ticket]\n\n## Missing Required Implementation Artifacts\n\n**QA FAILED:** Required implementation artifacts are missing. QA cannot proceed without complete implementation artifacts.\n\n**Missing artifacts:**\n- Plan artifact (`Plan for ticket 0076`)\n- PM Review artifact (`PM Review for ticket 0076`)\n\n**Present artifacts:**\n- Worklog artifact\n- Changed Files artifact\n- Decisions artifact\n- Verification artifact\n\n## Verdict\n\n**FAIL** — Implementation artifacts incomplete. Implementation agent must store all required artifacts before QA can proceed.\n\nQA RESULT: FAIL — 0076\n```\n\n**If all required artifacts are present:** Proceed with normal QA workflow (code review, verification, etc.).\n\n**CRITICAL:** Artifact verification is the **first and mandatory step** of QA. Do not skip it, do not defer it, do not proceed with code review if verification fails. If you cannot verify artifacts exist, the ticket fails QA.\n\n## Required artifact (QA report)\n\n- **Storage:** Supabase `agent_artifacts` table (via HAL API endpoint `/api/artifacts/insert-qa`)\n- **When:** After performing QA (code review and, if possible, UI verification) for a ticket, OR when auto-failing due to missing implementation artifacts.\n- **Agent type:** `qa`\n- **Title format:** `QA report for ticket <ticket-id>`\n\n## QA report structure\n\n1. **Ticket & deliverable** — One-line goal, deliverable, and acceptance criteria from the ticket.\n2. **Missing Required Implementation Artifacts** (if applicable) — List of missing artifacts. If artifacts are missing, this section must be present and QA must fail.\n3. **Audit artifacts** — Confirm all required implementation artifacts are present in Supabase (plan, worklog, changed-files, decisions, verification, pm-review). Only include this section if all artifacts are present.\n4. **Code review** — PASS/FAIL with brief evidence (e.g. table of requirement vs implementation; file and line refs if helpful). Only include if artifacts are present.\n5. **Build verification** — **MANDATORY:** Run `npm run build:hal` (or `tsc -b`) and verify it completes with zero TypeScript errors. If TypeScript errors exist, QA **MUST FAIL** immediately. Document the build result (PASS/FAIL) and any TypeScript errors found. Only include if artifacts are present.\n6. **UI verification** — What was run: automated and/or manual steps. If automated UI was not run (e.g. native dialogs, login, or pickers), state that and list the manual steps the user should run. Only include if artifacts are present.\n7. **Verdict** — Implementation complete? OK to merge? Any blocking manual verification? Must clearly state PASS or FAIL.\n\n## Storing QA report\n\n**Send a tool call to HAL in your message:**\n\nInclude this JSON block in your message:\n\n```json\n{\n  \"tool\": \"insert_qa_artifact\",\n  \"params\": {\n    \"ticketId\": \"0076\",\n    \"title\": \"QA report for ticket 0076\",\n    \"body_md\": \"# QA Report\\n\\n...\"\n  }\n}\n```\n\nHAL will parse this from your message, execute it, and store the artifact in Supabase. You don't need API URLs or credentials - just include the JSON in your message.\n\n## QA completion: do not hand off to the user\n\nWhen the verdict is **PASS (OK to merge)**, QA must **complete the full workflow** — do not stop at a summary or \"next steps for the user.\"\n\n## Completion message format requirement\n\n**MANDATORY:** The final completion message to the user **must** include the ticket ID and an explicit PASS/FAIL outcome token in a consistent, easy-to-spot format.\n\n- **Format:** `QA RESULT: <PASS|FAIL> — <ticket-id>`\n- **Examples:**\n  - `QA RESULT: PASS — 0056`\n  - `QA RESULT: FAIL — 0056`\n- **Placement:** This must appear in the final summary message that QA sends to the user after completing all workflow steps (merge, branch deletion, ticket updates, etc.).\n- **Why:** HAL needs to reliably parse QA outcomes from chat transcripts. The format must be human-verifiable (no external tooling required) and consistently structured for automated interpretation.\n- **Verification:** A human can read the QA chat transcript in the app and immediately see the ticket ID and outcome without parsing complex prose.\n\n**If you are verifying from the feature branch** (normal workflow):\n\n1. **Store QA report in Supabase** — Include a tool call in your message:\n   ```json\n   {\n     \"tool\": \"insert_qa_artifact\",\n     \"params\": {\n       \"ticketId\": \"0076\",\n       \"title\": \"QA report for ticket 0076\",\n       \"body_md\": \"# QA Report\\n\\n...\"\n     }\n   }\n   ```\n2. **Update ticket body** (optional) — If needed, include a tool call to update the ticket body:\n   ```json\n   {\n     \"tool\": \"update_ticket_body\",\n     \"params\": {\n       \"ticketId\": \"0076\",\n       \"body_md\": \"# Updated ticket body...\"\n     }\n   }\n   ```\n3. **Move ticket to Human in the Loop** — Include a tool call:\n   ```json\n   {\n     \"tool\": \"move_ticket_column\",\n     \"params\": {\n       \"ticketId\": \"0076\",\n       \"columnId\": \"col-human-in-the-loop\"\n     }\n   }\n   ```\n4. **Merge to main** — checkout `main`, merge the feature branch, push `main`.\n5. **Delete the feature branch** — local and remote (see `delete-branch-after-merge.mdc`).\n6. **Then** give your summary to the user. **The final message must include:** `QA RESULT: PASS — <ticket-id>` (see \"Completion message format requirement\" above).\n\n**If you are verifying from `main`** (implementation was merged to main for QA access):\n\n1. **Store QA report in Supabase** — Include a tool call in your message. Include a note in the report that verification was performed against `main`.\n2. **Update ticket body** (optional) — If needed, include a tool call to note that verification was performed against `main`.\n3. **Move ticket to Human in the Loop** — Include a tool call to move the ticket.\n4. **Then** give your summary to the user. **The final message must include:** `QA RESULT: PASS — <ticket-id>` (see \"Completion message format requirement\" above).\n\nDo not give a summary with \"next steps\" or \"run these commands\" — QA performs the merge (or confirms main) and branch deletion where applicable. The user receives the completed result.\n\n- Use a commit subject that includes the ticket ID (e.g. `qa(0033): add QA report, move to Human in the Loop`).\n- **If verdict is FAIL:** Do not merge. Store the QA report in Supabase, then **YOU MUST move the ticket to the top of To-do** (`col-todo` column) via HAL API. **This is MANDATORY** - failing to move the ticket to To-do means the QA workflow is incomplete. Summarize findings and recommend a bugfix ticket (see `bugfix-tracking.mdc`). **The final message must include:** `QA RESULT: FAIL — <ticket-id>` (see \"Completion message format requirement\" above).\n  \n  **FAIL workflow:**\n  1. **Store QA report in Supabase** — Include a tool call in your message:\n     ```json\n     {\n       \"tool\": \"insert_qa_artifact\",\n       \"params\": {\n         \"ticketId\": \"0076\",\n         \"title\": \"QA report for ticket 0076\",\n         \"body_md\": \"# QA Report\\n\\n...\"\n       }\n     }\n     ```\n  2. **Move ticket to To-do** — **REQUIRED**: You MUST include this tool call. The ticket MUST be moved to `col-todo` when QA fails. This is not optional. Include a tool call to move the ticket to `col-todo`:\n     ```json\n     {\n       \"tool\": \"move_ticket_column\",\n       \"params\": {\n         \"ticketId\": \"0076\",\n         \"columnId\": \"col-todo\"\n       }\n     }\n     ```\n     **Note:** The goal is to move failed tickets to the **top** of the To-do column for priority handling. The current move API (`/api/tickets/move`) appends tickets to the end of the column. If the API is enhanced in the future to support position parameters, use position 0 or a negative value to place at the top. For now, moving to `col-todo` satisfies the requirement even if it's at the end initially.\n  3. **Then** give your summary to the user. **The final message must include:** `QA RESULT: FAIL — <ticket-id>`.\n\n## HAL Tool Call Contract\n\nAll Supabase operations are sent to HAL as **tool calls** in your messages. HAL parses and executes them automatically.\n\n**Available tools:**\n\n- **`insert_qa_artifact`** — Store QA report in Supabase\n  - Params: `{ ticketId: string, title: string, body_md: string }`\n\n- **`update_ticket_body`** — Update ticket body in Supabase\n  - Params: `{ ticketId: string, body_md: string }`\n\n- **`move_ticket_column`** — Move ticket to different column\n  - Params: `{ ticketId: string, columnId: string }`\n\n- **`get_ticket_content`** — Fetch ticket content\n  - Params: `{ ticketId: string }`\n\n**How to use:** Include tool calls as JSON blocks in your messages. HAL will parse and execute them. You don't need API URLs or credentials.\n\nSee `docs/process/agent-supabase-api-paradigm.mdc` for full documentation.\n\n## Scope\n\n- Applies to any QA or verification of a **ticketed** task (ticket in Supabase).\n- Keep the report concise; use bullets and tables where appropriate.\n- All artifacts are stored in Supabase, not in `docs/audit/` folders.",
      "agentTypes": [
        "all",
        "qa-agent",
        "implementation-agent"
      ],
      "topicId": "qa-audit-report",
      "isBasic": false,
      "isSituational": false
    }
  ],
  "basic": [],
  "situational": []
}